!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t=t||self).VirtualScroller={},t.React)}(this,function(t,e){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}e=e&&e.hasOwnProperty("default")?e.default:e;var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var o="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function s(){}function u(){}u.resetWarningCache=s;!function(t,e){t(e={exports:{}},e.exports)}(function(t){t.exports=function(){function t(t,e,n,i,r,s){if(s!==o){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:u,resetWarningCache:s};return n.PropTypes=n,n}()});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};function l(t,e){return t===e}function f(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var i=e.length,r=0;r<i;r++)if(!t(e[r],n[r]))return!1;return!0}function h(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every(function(t){return"function"==typeof t})){var n=e.map(function(t){return void 0===t?"undefined":c(t)}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return e}var p=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var o=0,s=i.pop(),u=h(i),c=t.apply(void 0,[function(){return o++,s.apply(null,arguments)}].concat(n)),a=function(){for(var t=[],e=u.length,n=0;n<e;n++)t.push(u[n].apply(null,arguments));return c.apply(null,t)};return a.resultFunc=s,a.recomputations=function(){return o},a.resetRecomputations=function(){return o=0},a}}(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n=null,i=null;return function(){return f(e,n,arguments)||(i=t.apply(null,arguments)),n=arguments,i}});var d,g=(d=function(t){return[t.props,t.state]},function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r=p.apply(void 0,n);return d?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return r.apply(void 0,a(d(e)).concat([e]))}:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return r(e)}});function _(){return(_=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var v="Expected a function",m=NaN,y="[object Symbol]",w=/^\s+|\s+$/g,R=/^[-+]0x[0-9a-f]+$/i,S=/^0b[01]+$/i,T=/^0o[0-7]+$/i,b=parseInt,I="object"==typeof r&&r&&r.Object===Object&&r,E="object"==typeof self&&self&&self.Object===Object&&self,P=I||E||Function("return this")(),L=Object.prototype.toString,O=Math.max,U=Math.min,x=function(){return P.Date.now()};function B(t,e,n){var i,r,o,s,u,c,a=0,l=!1,f=!1,h=!0;if("function"!=typeof t)throw new TypeError(v);function p(e){var n=i,o=r;return i=r=void 0,a=e,s=t.apply(o,n)}function d(t){var n=t-c;return void 0===c||n>=e||n<0||f&&t-a>=o}function g(){var t=x();if(d(t))return _(t);u=setTimeout(g,function(t){var n=e-(t-c);return f?U(n,o-(t-a)):n}(t))}function _(t){return u=void 0,h&&i?p(t):(i=r=void 0,s)}function m(){var t=x(),n=d(t);if(i=arguments,r=this,c=t,n){if(void 0===u)return function(t){return a=t,u=setTimeout(g,e),l?p(t):s}(c);if(f)return u=setTimeout(g,e),p(c)}return void 0===u&&(u=setTimeout(g,e)),s}return e=D(e)||0,A(n)&&(l=!!n.leading,o=(f="maxWait"in n)?O(D(n.maxWait)||0,e):o,h="trailing"in n?!!n.trailing:h),m.cancel=function(){void 0!==u&&clearTimeout(u),a=0,i=c=r=u=void 0},m.flush=function(){return void 0===u?s:_(x())},m}function A(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function D(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&L.call(t)==y}(t))return m;if(A(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=A(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(w,"");var n=S.test(t);return n||T.test(t)?b(t.slice(2),n?2:8):R.test(t)?m:+t}var H=function(t,e,n){var i=!0,r=!0;if("function"!=typeof t)throw new TypeError(v);return A(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),B(t,e,{leading:i,maxWait:e,trailing:r})},N=function(){return null};var k=function(t){function r(e){var i;return(i=t.call(this,e)||this)._refs={},i._handleViewRefUpdate=i._handleViewRefUpdate.bind(n(i)),i}i(r,t);var o=r.prototype;return o._handleViewRefUpdate=function(t){this._view=t},o._handleItemRefUpdate=function(t,e){e?this._refs[t]=e:delete this._refs[t]},o._renderContent=function(){var t=this;return this.props.list.map(function(n,i){var r=n.id,o=n.data,s=t.props.renderItem(o,i),u="function"==typeof s.ref?s.ref:N;return e.cloneElement(s,{key:r,ref:function(e){t._handleItemRefUpdate(r,e),u(e)}})})},o.getWrapperNode=function(){return this._view},o.getItemHeights=function(){var t=this,e=this.props,n=e.list,i=e.getHeightForDomNode;return n.reduce(function(e,n){var r=n.id,o=t._refs[r];return e[r]=i(o),e},{})},o.render=function(){var t=this.props,n=t.blankSpaceAbove,i=t.blankSpaceBelow;return e.createElement("div",{ref:this._handleViewRefUpdate,style:{paddingTop:n,paddingBottom:i},onScroll:this.handleScroll},this._renderContent())},r}(e.PureComponent);function W(t,e){var n=!1,i=function(){n=!1,t()};return function(){n||e(i),n=!0}}function V(t,e,n){void 0===n&&(n=0);for(var i=0+n;i<t.length;i++)if(e(t[i],i))return i;return-1}function j(t,e,n){return t>=e&&t<n}k.defaultProps={getHeightForDomNode:function(t){return t?t.getBoundingClientRect().height:0}};var C=function(){function t(t){var e=void 0===t?{}:t,n=e.top,i=void 0===n?0:n,r=e.left,o=void 0===r?0:r,s=e.height,u=void 0===s?0:s,c=e.width,a=void 0===c?0:c;this._top=i,this._left=o,this._height=u,this._width=a}var e=t.prototype;return e.getTop=function(){return this._top},e.getBottom=function(){return this._top+this._height},e.getLeft=function(){return this._left},e.getRight=function(){return this._left+this._width},e.getHeight=function(){return this._height},e.getWidth=function(){return this._width},e.doesIntersectWith=function(t){var e=this.getTop(),n=this.getBottom(),i=this.getLeft(),r=this.getRight(),o=t.getTop(),s=t.getBottom(),u=t.getLeft(),c=t.getRight();return j(e,o,s)||j(o,e,n)||j(i,u,c)||j(u,i,r)},e.contains=function(t){return void 0===t.x?j(t.y,this.getTop(),this.getBottom()):void 0===t.y?j(t.x,this.getLeft(),this.getRight()):j(t.y,this.getTop(),this.getBottom())&&j(t.x,this.getLeft(),this.getRight())},e.translateBy=function(e,n){var i=this.getLeft(),r=this.getTop();return e&&(i+=e),n&&(r+=n),new t({left:i,top:r,width:this.getWidth(),height:this.getHeight()})},t}(),M=function(){function t(t){var e=t.viewportRectangle,n=t.list,i=t.rectangles,r=t.sliceStart,o=t.sliceEnd;this._viewportRectangle=e,this._list=n,this._rectangles=i,this._sliceStart=r,this._sliceEnd=o}var e=t.prototype;return e.getViewportRect=function(){return this._viewportRectangle},e.getListRect=function(){var t=this._list;if(t.length<=0)return new C({top:0,height:0});var e=this._rectangles,n=t[0].id,i=t[t.length-1].id,r=e[n].getTop(),o=e[i].getBottom()-r;return new C({top:r,height:o})},e.getAllItems=function(){var t=this;return this._list.map(function(e){var n=e.id;return{id:n,rectangle:t._rectangles[n]}})},e.getList=function(){return this._list},e.getItemRect=function(t){return this._rectangles[t]},e.findVisibleItems=function(){var t=this,e=this._viewportRectangle,n=this._rectangles,i=this._list,r=V(i,function(t){var i=t.id;return n[i].doesIntersectWith(e)});if(r<0)return[];var o=V(i,function(t){var i=t.id;return!n[i].doesIntersectWith(e)},r);return o<0&&(o=i.length),i.slice(r,o).filter(function(e){var n=e.id;return t.isRendered(n)}).map(function(t){var e=t.id;return{id:e,rectangle:n[e]}})},e.getRenderedItems=function(){var t=this._rectangles;return this._list.slice(this._sliceStart,this._sliceEnd).map(function(e){var n=e.id;return{id:n,rectangle:t[n]}})},e.isRendered=function(t){return this._getRenderedIdSet().hasOwnProperty(t)},e._getRenderedIdSet=function(){if(!this._renderedIdSet){this._renderedIdSet={};for(var t=this._sliceStart;t<this._sliceEnd;t++)this._renderedIdSet[this._list[t].id]=!0}return this._renderedIdSet},t}(),F=function(){function t(t,e){void 0===e&&(e=t),this._scroller=e,this._window=t,this._programticScrollListeners=[],this._offsetTop=0,this._useWindow=this._scroller===this._window}var e=t.prototype;return e._getScrollerHeight=function(){return this._useWindow?Math.ceil(this._window.document.documentElement.clientHeight):Math.ceil(this._scroller.clientHeight)},e._addListener=function(t,e,n){var i=n?this._window:this._scroller,r=function(){return e()};return i.addEventListener(t,r),function(){i.removeEventListener(t,r)}},e.getRectRelativeTo=function(t){var e=t.getBoundingClientRect().top,n=this._useWindow?0:this._scroller.getBoundingClientRect().top;return this.getRect().translateBy(0,Math.ceil(n-e))},e.getOffsetTop=function(){return this._offsetTop},e.setOffsetTop=function(t){this._offsetTop=Math.ceil(t)},e.getRect=function(){var t=this._getScrollerHeight(),e=Math.max(0,t-this._offsetTop);return new C({top:this._offsetTop,height:e})},e.scrollX=function(){return this._useWindow?-1*this._window.document.body.getBoundingClientRect().left:this._scroller.scrollLeft},e.scrollY=function(){return this._useWindow?-1*this._window.document.body.getBoundingClientRect().top:this._scroller.scrollTop},e.scrollBy=function(t){this._useWindow?this._window.scrollBy(0,t):this._scroller.scrollTop+=t,this._programticScrollListeners.forEach(function(e){return e(t)})},e.scrollTo=function(t){this._useWindow?this._window.scrollTo(0,t):this._scroller.scrollTop=t,this._programticScrollListeners.forEach(function(e){return e(t)})},e.addRectChangeListener=function(t){return this._addListener("resize",t,!0)},e.addScrollListener=function(t){return this._addListener("scroll",t,!1)},e.addProgrammaticScrollListener=function(t){var e=this;return this._programticScrollListeners.indexOf(t)<0&&this._programticScrollListeners.push(t),function(){return e.removeProgrammaticScrollListener(t)}},e.removeProgrammaticScrollListener=function(t){var e=this._programticScrollListeners.indexOf(t);e>-1&&this._programticScrollListeners.splice(e,1)},t}(),q=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function z(t,e){var n=function(t,e){var n,i,r=t.getViewportRect(),o=function(t){return t&&t.doesIntersectWith(r)},s=function(t){return t?Math.abs(r.getTop()-t.getTop()):1/0},u=e.getList().filter(function(n){var i=n.id;return t.isRendered(i)&&e.isRendered(i)});return u.length<=0?null:(i=function(e,n){var i,r,u,c,a=t.getItemRect(e.id),l=t.getItemRect(n.id);return r=l,u=(i=o)(a),c=i(r),(u&&!c?1:!u&&c?-1:0)||function(t,e,n){var i=t(e);return t(n)-i}(s,a,l)},(n=u).length<=0?null:n.reduce(function(t,e){return i(e,t)>0?e:t}))}(t,e);if(!n)return 0;var i=n.id,r=t.getItemRect(i).getTop()-t.getViewportRect().getTop();return e.getItemRect(i).getTop()-e.getViewportRect().getTop()-r}function $(t,e,n){var i={},r=0;return t.forEach(function(t){var o=t.id,s=void 0!==e[o]?e[o]:n;i[o]=new C({top:r,height:s}),r+=s}),i}var Y=function(t){function r(e){var i;return(i=t.call(this,e)||this)._heights={},i._getRectangles=g(n(i),function(t){return t.list},function(t,e,n){return n._heights},function(t){return t.assumedItemHeight},$),i._getSlice=g(n(i),function(t){return t.list},function(t,e){return e.sliceStart},function(t,e){return e.sliceEnd},function(t,e,n){return t.slice(e,n)}),i.state=i._getDefaultSlice(e.list),i._handleRefUpdate=i._handleRefUpdate.bind(n(i)),i._update=i._update.bind(n(i)),i._notifyPositioning=i._notifyPositioning.bind(n(i)),i._scheduleUpdate=W(i._update,q),i._schedulePositioningNotification=W(i._notifyPositioning,q),i._handleScroll=H(i._scheduleUpdate,100,{trailing:!0}),i}i(r,t);var o=r.prototype;return o._handleRefUpdate=function(t){this._listRef=t},o._onHeightsUpdate=function(t,e){this.props.viewport.scrollBy(z(t,e))},o._recordHeights=function(){var t=this;if(!this._listRef)return{heightDelta:0};var e=this._listRef.getItemHeights(),n=Object.keys(e).reduce(function(n,i){var r=t._heights.hasOwnProperty(i)?t._heights[i]:t.props.assumedItemHeight;return n+e[i]-r},0);return 0!==n&&(this._heights=Object.assign({},this._heights,e)),{heightDelta:n}},o._postRenderProcessing=function(t){var e=this._recordHeights(),n=0!==e.heightDelta;(t||n)&&this._prevPositioning&&this._onHeightsUpdate(this._prevPositioning,this.getPositioning()),(t||Math.abs(e.heightDelta)>=this.props.assumedItemHeight)&&this._scheduleUpdate(),this._schedulePositioningNotification()},o._getDefaultSlice=function(t){var e=_({},this,{props:_({},this.props,{list:t})}),n=this.props.viewport.getRect().getHeight(),i=this._getRectangles(e),r=t[0].id,o=i[r].getTop(),s=V(t,function(t){return i[t.id].getTop()-o>=n},0);return s<0&&(s=t.length),{sliceStart:0,sliceEnd:s}},o._computeBlankSpace=function(){var t=this.props.list,e=this.state,n=e.sliceStart,i=e.sliceEnd,r=this._getRectangles(),o=t.length-1;return{blankSpaceAbove:t.length<=0?0:r[t[n].id].getTop()-r[t[0].id].getTop(),blankSpaceBelow:i>=t.length?0:r[t[o].id].getBottom()-r[t[i].id].getTop()}},o._getRelativeViewportRect=function(){if(!this._listRef)return new C({top:0,height:0});var t=this._listRef.getWrapperNode();return this.props.viewport.getRectRelativeTo(t)},o._update=function(){var t=this.props.list;if(!this._unmounted&&0!==t.length){var e=this._getRelativeViewportRect(),n=e.getHeight()*this.props.offscreenToViewportRatio,i=e.getTop()-n,r=e.getBottom()+n,o=this._getRectangles(),s=V(t,function(t){return o[t.id].getBottom()>i});s<0&&(s=t.length-1);var u=V(t,function(t){return o[t.id].getTop()>=r},s);u<0&&(u=t.length),this._schedulePositioningNotification(),this._setSlice(s,u)}},o._setSlice=function(t,e){var n=this.state,i=n.sliceStart,r=n.sliceEnd;i===t&&r===e||this.setState({sliceStart:t,sliceEnd:e})},o._notifyPositioning=function(){!this._unmounted&&this.props.onPositioningUpdate&&this.props.onPositioningUpdate(this.getPositioning())},o.scrollToIndex=function(t){var e=this.props,n=e.list,i=e.viewport,r=n[t],o=this._getRectangles();i.scrollTo(o[r.id].getTop()+i.getOffsetTop())},o.getPositioning=function(){var t=this.state,e=t.sliceStart,n=t.sliceEnd;return new M({viewportRectangle:this._getRelativeViewportRect(),list:this.props.list,rectangles:this._getRectangles(),sliceStart:e,sliceEnd:n})},o.componentDidMount=function(){this._unlistenScroll=this.props.viewport.addScrollListener(this._handleScroll),this._postRenderProcessing(!0)},o.componentWillReceiveProps=function(t){var e=this.props.list,n=this.state,i=t.list;if(e!==i){var r=function(t,e,n,i){var r=e.reduce(function(t,e){return t[e.id]=!0,t},{}),o=function(t,e,n){if(e<0||e>=t.length)return-1;if(n(t[e]))return e;for(var i=1;;i++){var r=e-i,o=e+i,s=r<0,u=o>=t.length;if(s&&u)break;if(!u&&n(t[o]))return o;if(!s&&n(t[r]))return r}return-1}(t,n,function(t){return r[t.id]});if(-1===o)return null;var s=V(e,function(e){return t[o].id===e.id});return{sliceStart:s,sliceEnd:Math.min(e.length,s+i-n)}}(e,i,n.sliceStart,n.sliceEnd)||this._getDefaultSlice(i);this._setSlice(r.sliceStart,r.sliceEnd)}},o.componentWillUpdate=function(){this._prevPositioning=this.getPositioning()},o.componentDidUpdate=function(t){this._postRenderProcessing(t.list!==this.props.list)},o.componentWillUnmount=function(){this._unmounted=!0,this._unlistenScroll&&this._unlistenScroll()},o.render=function(){var t=this._computeBlankSpace(),n=t.blankSpaceAbove,i=t.blankSpaceBelow,r=this.state.sliceStart,o=this.props.renderItem;return e.createElement(k,{ref:this._handleRefUpdate,list:this._getSlice(),blankSpaceAbove:n,blankSpaceBelow:i,renderItem:function(t,e){return o(t,r+e)}})},r}(e.PureComponent);Y.defaultProps={offscreenToViewportRatio:1.8,assumedItemHeight:400};var X={INSIDE:"inside",OUTSIDE:"outside"},G={INITIAL_POSITION:"init",MOVEMENT:"movement",LIST_UPDATE:"list-update"};var J={nearTop:function(t){return function(e,n){return n.getTop()-e.getTop()<=t}},nearBottom:function(t){return function(e,n){return e.getBottom()-n.getBottom()<=t}},nearTopRatio:function(t){return function(e,n){var i=n.getHeight(),r=t*i;return n.getTop()-e.getTop()<=r}},nearBottomRatio:function(t){return function(e,n){var i=n.getHeight(),r=t*i;return e.getBottom()-n.getBottom()<=r}}},K=function(){function t(t){this._handlers=t.map(function(t){return{zone:t,state:{}}})}return t.prototype.handlePositioningUpdate=function(t){this._handlers.forEach(function(e){var n,i,r=e.zone,o=e.state,s=r.condition,u=r.callback,c=function(t,e){return t(e.getListRect(),e.getViewportRect())?X.INSIDE:X.OUTSIDE}(s,t),a=t.getList().length,l=(i={proximity:c,listLength:a},(n=o).proximity||i.proximity!==X.INSIDE?n.proximity===X.OUTSIDE&&i.proximity===X.INSIDE?G.MOVEMENT:n.proximity===X.INSIDE&&i.proximity===X.INSIDE&&n.listLength!==i.listLength?G.LIST_UPDATE:null:G.INITIAL_POSITION);o.proximity=c,o.listLength=a,l&&u({triggerCause:l})})},t}(),Q=function(){return null},Z=function(t){function r(e){var i;return(i=t.call(this,e)||this)._getList=g(n(i),function(t){return t.items},function(t){var e={},n=[];return t.forEach(function(t){var r=i.props.identityFunction(t);e.hasOwnProperty(r)?console.warn('Duplicate item id generated in VirtualScroller. Latter item (id = "'+r+'") will be discarded'):(n.push({id:r,data:t}),e[r]=!0)}),n}),i._getScrollTracker=g(n(i),function(t){return t.nearStartProximityRatio},function(t){return t.nearEndProximityRatio},function(t,e){return new K([{condition:J.nearTop(5),callback:function(t){return i.props.onAtStart(t)}},{condition:J.nearTopRatio(t),callback:function(t){return i.props.onNearStart(t)}},{condition:J.nearBottomRatio(e),callback:function(t){return i.props.onNearEnd(t)}},{condition:J.nearBottom(5),callback:function(t){return i.props.onAtEnd(t)}}])}),i._handleRefUpdate=i._handleRefUpdate.bind(n(i)),i._handlePositioningUpdate=i._handlePositioningUpdate.bind(n(i)),i}i(r,t);var o=r.prototype;return o._handleRefUpdate=function(t){this._updater=t},o._handlePositioningUpdate=function(t){this._getScrollTracker().handlePositioningUpdate(t)},o.scrollToIndex=function(t){this._updater&&this._updater.scrollToIndex(t)},o.render=function(){var t=this.props,n=t.renderItem,i=t.assumedItemHeight,r=t.viewport;return e.createElement(Y,{ref:this._handleRefUpdate,list:this._getList(),renderItem:n,assumedItemHeight:i,viewport:r,onPositioningUpdate:this._handlePositioningUpdate})},r}(e.PureComponent);Z.defaultProps={identityFunction:function(t){return t.id},offscreenToViewportRatio:1.8,assumedItemHeight:400,nearEndProximityRatio:1.75,nearStartProximityRatio:.25,onAtStart:Q,onNearStart:Q,onNearEnd:Q,onAtEnd:Q},t.Viewport=F,t.VirtualScroller=Z,t.default=Z,Object.defineProperty(t,"__esModule",{value:!0})});
